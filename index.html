<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Acceso / Registro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c7a7b 0%, #38b2ac 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .header-content {
            flex: 1;
            padding-right: 20px;
        }

        .header-content h1 {
            color: white;
            font-size: 42px;
            margin-bottom: 15px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
            font-weight: 900;
            letter-spacing: 2px;
            background: linear-gradient(45deg, #fff, #ffeb3b, #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .header-content p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
            line-height: 1.6;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .user-counter {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }

        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            flex-direction: column; 
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
        }

        .login-container h2 {
            color: #2c7a7b;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }

        /* Controles de modo (Acceso/Registro) */
        .mode-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 5px;
            background: #e6fffa;
            border-radius: 10px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-mode {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background-color: transparent;
            color: #38b2ac;
        }

        .btn-mode.active {
            background: linear-gradient(135deg, #2c7a7b 0%, #38b2ac 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #2c7a7b;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #38b2ac;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #2c7a7b;
            box-shadow: 0 0 10px rgba(56, 178, 172, 0.3);
        }

        .btn-submit {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #2c7a7b 0%, #38b2ac 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            width: 100%;
            max-width: 1200px;
            
            /* Contexto de posicionamiento para el botón de eliminar cuenta */
            position: relative; 
            padding-bottom: 60px; /* Espacio extra para el botón en la esquina */
        }

        .section-title {
            color: white;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 40px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .boxes-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 50px;
            flex-wrap: wrap;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 50px;
        }

        .box-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .box-item:hover {
            transform: translateY(-10px);
        }

        .box {
            width: 280px;
            height: 280px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
            transition: all 0.3s;
        }

        .box:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .box-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 72px;
        }

        .box-label {
            margin-top: 20px;
            color: white;
            font-weight: bold;
            font-size: 22px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            max-width: 280px;
        }

        /* Estilo y POSICIONAMIENTO para el botón de eliminar cuenta */
        .delete-link {
            background: none;
            border: none;
            color: #e53e3e; /* Rojo de peligro */
            text-decoration: underline;
            cursor: pointer;
            font-size: 14px;
            padding: 0;
            transition: color 0.2s;
            
            /* Posicionamiento en la esquina inferior derecha del content-wrapper */
            position: absolute; 
            bottom: 20px; 
            right: 20px; 
            z-index: 10;
        }

        .delete-link:hover {
            color: #c53030;
        }

        .hidden {
            display: none;
        }

        /* Nuevo estilo para el rótulo "Próximamente" */
        .coming-soon-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg); /* Centrado y ligeramente rotado */
            background: rgba(229, 62, 62, 0.9); /* Rojo semitransparente */
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 24px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            z-index: 5; /* Asegura que esté por encima de la imagen/placeholder */
            pointer-events: none; /* Permite hacer clic en el elemento subyacente si fuese necesario */
            animation: pulse 1.5s infinite; /* Animación para destacar */
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) rotate(-15deg) scale(1); opacity: 0.9; }
            50% { transform: translate(-50%, -50%) rotate(-15deg) scale(1.05); opacity: 1; }
            100% { transform: translate(-50%, -50%) rotate(-15deg) scale(1); opacity: 0.9; }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }
            .delete-link {
                /* Centrar en móviles para mejor visualización */
                position: static; 
                margin-top: 20px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>La IA Musical</h1>
            <p>Un universo lleno de posibilidades se entremezclan gracias a la música creada por la IA.</p>
        </div>
        <div class="user-counter">
            👥 Usuarios: <span id="userCount">0</span>
        </div>
    </div>

    <div class="main-content">
        <div id="loginFormContainer" class="login-container">
            <h2 id="formTitle">Acceso de Usuario</h2>
            
            <div class="mode-controls">
                <button type="button" class="btn-mode active" id="btn-mode-login">ACCESO</button>
                <button type="button" class="btn-mode" id="btn-mode-register">REGISTRO</button>
            </div>
            
            <form id="authForm">
                <div class="form-group hidden" id="emailGroup">
                    <label for="email">Correo Electrónico</label>
                    <input type="email" id="email">
                </div>
                
                <div class="form-group" id="usernameGroup">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" required>
                </div>
                
                <div class="form-group hidden" id="confirmPasswordGroup">
                    <label for="confirmPassword">Confirmar Contraseña</label>
                    <input type="password" id="confirmPassword">
                </div>
                
                <button type="submit" class="btn-submit" id="submitButton">Acceder</button>
            </form>
        </div>

        <div id="mainContent" class="content-wrapper hidden">
            <h2 class="section-title">Selecciona un tema:</h2>
            <div class="boxes-container">
                <div class="box-item" onclick="navigate('literatura')">
                    <div class="box">
                        <img src="images/literatura.png" alt="literatura">
                    </div>
                    <div class="box-label">Literatura musical</div>
                </div>

                <div class="box-item" onclick="navigate('cine')">
                    <div class="box">
                        <img src="images/cine.png">
                        <div class="box-placeholder">🎬</div>
                        <div class="coming-soon-label">Próximamente</div>
                    </div>
                    <div class="box-label">Cine</div>
                </div>

                <div class="box-item" onclick="navigate('opera')">
                    <div class="box">
                        <img src="images/opera.png">
                        <div class="box-placeholder">🎸</div>
                        <div class="coming-soon-label">Próximamente</div>
                    </div>
                    <div class="box-label">Ópera</div>
                </div>
                
                <div class="box-item" onclick="navigate('cuentos')">
                    <div class="box">
                        <img src="images/cuentosmusicales.png">
                        <div class="box-placeholder">📚</div>
                        <div class="coming-soon-label">Próximamente</div>
                    </div>
                    <div class="box-label">Cuentos musicales</div>
                </div>
                </div>
            
            <button id="deleteAccountLink" class="delete-link" onclick="deleteAccount()">
                Eliminar cuenta
            </button>
        </div>
    </div>

    <script>
        // Simulación de base de datos en memoria (almacenada en localStorage)
        let users = {};
        let currentUser = null; // Almacena el email del usuario logueado
        let currentMode = 'login'; // 'login' o 'register'
        // MODIFICADO: 12 horas en milisegundos (12 * 60 minutos * 60 segundos * 1000 milisegundos)
        const SESSION_DURATION = 12 * 60 * 60 * 1000; 

        // NOTA: Es crucial que estas referencias a elementos del DOM sean globales
        const formTitle = document.getElementById('formTitle');
        const authForm = document.getElementById('authForm');
        const submitButton = document.getElementById('submitButton');
        const btnLogin = document.getElementById('btn-mode-login');
        const btnRegister = document.getElementById('btn-mode-register');
        const emailInput = document.getElementById('email');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const emailGroup = document.getElementById('emailGroup');
        const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');

        // --- Funciones de Persistencia ---

        function getStoredData(key, useLocalStorage = false) {
            try {
                // Usa localStorage si se pide (true) o por defecto sessionStorage (false)
                const storage = useLocalStorage ? localStorage : sessionStorage;
                const data = storage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch {
                return null;
            }
        }

        function saveData(key, data, useLocalStorage = false) {
            try {
                // Usa localStorage si se pide (true) o por defecto sessionStorage (false)
                const storage = useLocalStorage ? localStorage : sessionStorage;
                storage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error('Error al guardar datos:', e);
            }
        }
        
        // --- Lógica de Sesión de 12 Horas (USA LOCALSTORAGE) ---

        function updateSession(email) {
            // Calcula el tiempo de expiración (hora actual + 12 horas)
            const expirationTime = Date.now() + SESSION_DURATION; 
            currentUser = email;
            // Guarda el usuario y la hora de expiración en LOCALSTORAGE (Persistencia a largo plazo)
            saveData('sessionData', { currentUser: email, expirationTime: expirationTime }, true); 
        }

        function clearSession() {
             // Elimina los datos de sesión de LOCALSTORAGE
            localStorage.removeItem('sessionData'); 
            currentUser = null;
            // Recarga para volver al formulario de login
            window.location.reload(); 
        }
        
        // --- Funciones de Utilidad y Búsqueda ---
        
        function findUserByUsername(username) {
            const lowerUsername = username.toLowerCase();
            for (const email in users) {
                if (users[email].username.toLowerCase() === lowerUsername) {
                    return { email: email, ...users[email] }; 
                }
            }
            return null;
        }


        // --- Funciones de Lógica de UI/Modo ---

        function setFormMode(mode) {
            currentMode = mode;
            
            // 1. Actualizar estilos de botones
            btnLogin.classList.remove('active');
            btnRegister.classList.remove('active');
            if (mode === 'login') {
                btnLogin.classList.add('active');
            } else {
                btnRegister.classList.add('active');
            }
            
            // 2. Ocultar/Mostrar campos específicos
            const isRegister = mode === 'register';
            formTitle.textContent = isRegister ? 'Registro de Nuevo Usuario' : 'Acceso de Usuario';
            submitButton.textContent = isRegister ? 'Registrarse' : 'Acceder';

            // Email y Confirmar Contraseña solo visibles en Registro
            emailGroup.classList.toggle('hidden', !isRegister);
            confirmPasswordGroup.classList.toggle('hidden', !isRegister);

            // 3. Controlar atributos required
            emailInput.required = isRegister;
            confirmPasswordInput.required = isRegister;
            
            // Limpiar inputs al cambiar de modo
            authForm.reset(); 
        }

        // --- Manejo de la AUTENTICACIÓN ---

        if (authForm) { // Comprobar que el formulario existe
            authForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = emailInput.value.toLowerCase();
                const password = passwordInput.value;
                const enteredUsername = usernameInput.value;
                const confirmPassword = confirmPasswordInput.value;
                
                if (!enteredUsername) return; 

                if (currentMode === 'login') {
                    // Lógica de ACCESO
                    
                    const userRecord = findUserByUsername(enteredUsername);

                    if (!userRecord) {
                        alert('Usuario no encontrado. Por favor, verifica tu nombre de usuario o regístrate.');
                        return;
                    }

                    if (userRecord.password === password) {
                        updateSession(userRecord.email); // INICIO DE SESIÓN: Usa LOCALSTORAGE
                        authForm.reset();
                        alert(`¡Inicio de sesión exitoso! ¡Bienvenido de vuelta, ${userRecord.username}!`);
                        showMainContent();
                    } else {
                        alert('Contraseña incorrecta. Por favor, inténtalo de nuevo.');
                    }
                    
                } else {
                    // Lógica de REGISTRO
                    
                    const isExistingEmail = !!users[email];
                    const isExistingUsername = !!findUserByUsername(enteredUsername); 

                    if (isExistingEmail) {
                        alert('Este correo ya está registrado. Por favor, usa la pestaña de ACCESO o un correo diferente.');
                        return;
                    }
                    
                    if (isExistingUsername) {
                        alert('Este nombre de usuario ya está en uso. Por favor, elige uno diferente.');
                        return;
                    }

                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden. Por favor, inténtalo de nuevo.');
                        return;
                        }

                    users[email] = {
                        username: enteredUsername,
                        password: password,
                        registeredAt: new Date().toISOString()
                    };
                    saveData('users', users, true); 

                    updateSession(email); // REGISTRO: Usa LOCALSTORAGE
                    authForm.reset();
                    alert('¡Registro exitoso! Ya puedes usar la aplicación.');
                    updateUserCount();
                    showMainContent(); // Acceder automáticamente después del registro
                }
            });
        }


        // Event Listeners para los botones de modo
        if (btnLogin) {
            btnLogin.addEventListener('click', () => setFormMode('login'));
        }
        if (btnRegister) {
            btnRegister.addEventListener('click', () => setFormMode('register'));
        }


        // --- LÓGICA DE ELIMINAR CUENTA ---

        function deleteAccount() {
            if (!currentUser) {
                alert('Error: No hay una sesión activa para eliminar. Por favor, inicia sesión de nuevo.');
                window.location.reload(); 
                return;
            }
            
            if (!confirm('¿Estás seguro de que quieres eliminar tu cuenta? Esta acción es irreversible.')) {
                return;
            }
            
            // Pedir contraseña para confirmar
            const password = prompt(`Por favor, introduce tu CONTRASEÑA para confirmar la eliminación de la cuenta de ${users[currentUser].username}:`);
            
            if (!password) {
                alert('Eliminación cancelada.');
                return;
            }

            const userRecord = users[currentUser];

            if (userRecord.password !== password) {
                alert('Error: La contraseña introducida no es correcta. La cuenta NO ha sido eliminada.');
                return;
            }
            
            const usernameDeleted = userRecord.username;
            
            delete users[currentUser];
            saveData('users', users, true); 

            clearSession(); // Limpia la sesión de LOCALSTORAGE
            
            alert(`La cuenta de "${usernameDeleted}" ha sido eliminada exitosamente.`);
            window.location.reload(); 
        }


        // --- Funciones de Interfaz ---
        
        function showMainContent() {
            document.getElementById('loginFormContainer').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        function updateUserCount() {
            document.getElementById('userCount').textContent = Object.keys(users).length;
        }

        function navigate(section) {
            const urls = {
                'literatura': 'literaturamusical.html',
                'cine': '#', // Poner '#' o una URL temporal
                'opera': '#', // Poner '#' o una URL temporal
                'cuentos': '#' // Poner '#' o una URL temporal
            };
            
            // Puedes agregar aquí una lógica para mostrar una alerta si es 'Próximamente'
            if (section !== 'literatura') {
                alert(`La sección "${section.charAt(0).toUpperCase() + section.slice(1)}" está en desarrollo. ¡Vuelve pronto!`);
            } else {
                 window.location.href = urls[section];
            }
        }
        
        // --- Inicialización ---

        function init() {
            const storedUsers = getStoredData('users', true); 
            // Carga los datos de sesión usando LOCALSTORAGE
            const sessionData = getStoredData('sessionData', true); 
            
            if (storedUsers) {
                users = storedUsers;
            }
            
            // *** Lógica de expiración de 12 horas ***
            if (sessionData) {
                const now = Date.now();
                if (now < sessionData.expirationTime) {
                    // La sesión es válida: Mantiene el usuario logueado
                    currentUser = sessionData.currentUser; 
                    updateSession(sessionData.currentUser); // Restablece el timer para 12 horas más
                    showMainContent();
                } else {
                    // La sesión expiró: Limpia la sesión de LOCALSTORAGE
                    localStorage.removeItem('sessionData'); 
                    setFormMode('login'); 
                }
            } else {
                setFormMode('login'); 
            }
            
            updateUserCount();
        }

        // Inicializar la aplicación
        init();
    </script>
</body>
</html>