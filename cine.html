<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-R">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Literatura Musical - Versión Unificada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Animaciones Personalizadas (Del archivo literaturamusical.html) */
        @keyframes pulse-custom {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.3; }
        }
        @keyframes bounce-custom {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes blink-custom {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse-custom { animation: pulse-custom 3s ease-in-out infinite; }
        .animate-bounce-custom { animation: bounce-custom 2s ease-in-out infinite; }
        .animate-blink-custom { animation: blink-custom 1s step-start infinite; }

        /* Estilos Adaptados de Informacion.html (Para el modal de Info Global) */
        .info-header {
            background: linear-gradient(135deg, #FFC300 0%, #FF5733 100%);
        }

        .chat-title {
            color: #FF5733; /* Usando color de acento */
        }

        .comment-form {
            background: #f8f9fa; /* Fondo gris claro para el formulario */
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #FFC300; /* Color de foco */
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #FFC300 0%, #FF5733 100%);
        }
        
        .comment-item {
            border-left: 4px solid #FFC300; /* Borde con color de acento */
        }

        .comment-author {
            color: #FF5733; /* Autor con color de acento */
        }

        .btn-edit {
            background: #4CAF50;
            color: white;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .info-container {
            /* Adaptación del contenedor principal de Informacion.html */
            max-width: 900px;
            margin: 0 auto;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        
        /* Ajuste específico para móviles: reducir fuente en la navegación */
        @media (max-width: 768px) {
            .nav-link-text {
                font-size: 0.875rem; /* text-sm en Tailwind */
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-cyan-900 via-teal-800 to-emerald-900 text-white">
    
    <header class="relative overflow-hidden py-12 px-4">
        <div class="absolute inset-0 opacity-20">
            <div class="absolute top-0 left-1/4 w-96 h-96 bg-cyan-400 rounded-full blur-3xl animate-pulse-custom"></div>
            <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-teal-400 rounded-full blur-3xl animate-pulse-custom" style="animation-delay: 1s;"></div>
        </div>
        
        <div class="relative max-w-6xl mx-auto text-center">
            <div class="flex items-center justify-center mb-6">
                <svg class="w-16 h-16 mr-4 animate-bounce-custom" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                </svg>
                <h1 class="text-5xl md:text-7xl font-bold bg-gradient-to-r from-blue-200 via-cyan-300 to-teal-400 bg-clip-text text-transparent">
                    CINE ÉPICO
                </h1>
            </div>
            <p class="text-xl md:text-2xl text-cyan-100 max-w-3xl mx-auto leading-relaxed">
                Muchas frases de películas las volverás a recordar en una versión musical.
            </p>
        </div>
    </header>
    
    <nav class="bg-cyan-950/70 backdrop-blur-md sticky top-0 z-40 shadow-xl border-b border-cyan-700">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <div class="flex justify-center space-x-2 md:space-x-4">
                
                <a href="index.html" 
                   class="inline-flex items-center text-sm md:text-lg font-semibold text-cyan-100 hover:text-yellow-400 transition-colors py-2 px-2 md:px-3 rounded-lg hover:bg-cyan-800/50">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    <span class="nav-link-text">Temas</span>
                </a>
                
                <a href="Archivos.html" 
                   class="flex items-center space-x-1 text-sm md:text-lg font-semibold text-cyan-100 hover:text-yellow-400 transition-colors py-2 px-2 md:px-3 rounded-lg hover:bg-cyan-800/50">
                    <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h3"></path>
                    </svg>
                    <span class="nav-link-text">Archivos</span>
                </a>
                
                <a href="podcast.html" 
                   class="flex items-center space-x-1 text-sm md:text-lg font-semibold text-cyan-100 hover:text-yellow-400 transition-colors py-2 px-2 md:px-3 rounded-lg hover:bg-cyan-800/50">
                    <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                    </svg>
                    <span class="nav-link-text">Podcast</span>
                </a>
                
                <button onclick="openGlobalInfoModal()" 
                   class="flex items-center space-x-1 text-sm md:text-lg font-semibold text-cyan-100 hover:text-yellow-400 transition-colors py-2 px-2 md:px-3 rounded-lg hover:bg-cyan-800/50">
                    <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="nav-link-text">Info</span>
                </button>
            </div>
        </div>
    </nav>
    
    <div id="voteWarning" class="hidden fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-2xl z-50">
        ⚠️ Ya has usado tus 5 votos permitidos
    </div>

    <div class="max-w-6xl mx-auto px-4 mt-8 mb-8">
        <div class="bg-cyan-800/50 backdrop-blur-sm rounded-2xl p-4 text-center border border-cyan-600/50 flex items-center justify-center space-x-4">
            <p class="text-lg">
                Votos usados: <span id="voteCount" class="font-bold text-2xl text-yellow-300">0</span> / 5
            </p>
            
            <button 
                onclick="window.location.href='Nuevo.html'"
                class="relative bg-red-600 text-white px-4 py-2 rounded-lg font-bold text-sm uppercase shadow-xl hover:bg-red-700 transition duration-150 animate-blink-custom group"
            >
                Nuevo
                <span class="absolute hidden group-hover:block bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-max bg-gray-800 text-white text-xs rounded py-1 px-2 pointer-events-none z-50">
                    Escuchar nuevas entradas
                </span>
            </button>
            </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 mb-12">
        <h2 class="text-4xl font-bold text-center mb-8 flex items-center justify-center">
            <svg class="w-10 h-10 mr-3 text-yellow-400 fill-yellow-400" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
            </svg>
            TOP 3 DE LA SEMANA
            <svg class="w-10 h-10 ml-3 text-yellow-400 fill-yellow-400" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
            </svg>
        </h2>
        
        <div id="top3Container" class="grid md:grid-cols-3 gap-6"></div>
    </div>

    <div class="max-w-6xl mx-auto px-4 pb-12">
        <h2 class="text-3xl font-bold text-center mb-8">RANKING COMPLETO</h2>
        <div id="rankingContainer" class="grid md:grid-cols-2 lg:grid-cols-2 gap-6"></div>
    </div>
    
    <div id="audioModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="bg-gradient-to-br from-purple-900 to-pink-900 rounded-2xl max-w-md w-full p-6 border-2 border-purple-400">
            </div>
    </div>

    <div id="infoModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="bg-gradient-to-br from-cyan-900 to-teal-900 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border-2 border-cyan-400">
            <div class="sticky top-0 bg-gradient-to-r from-cyan-800 to-teal-800 p-4 flex justify-between items-center border-b border-cyan-600">
                <h2 class="text-2xl font-bold flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Información Detallada (Canción)
                </h2>
                <button onclick="closeInfoModal()" class="hover:bg-cyan-700 p-2 rounded-full transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div id="infoContent" class="p-6"></div>
        </div>
    </div>
    
    <div id="lyricsModal" class="hidden fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="bg-gray-900 rounded-2xl max-w-xl w-full max-h-[90vh] overflow-y-auto border-2 border-blue-400 shadow-2xl">
            <div class="sticky top-0 bg-blue-900 p-4 flex justify-between items-center border-b border-blue-700">
                <h2 id="lyricsModalTitle" class="text-xl md:text-2xl font-bold text-white flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Letra: <span id="currentSongTitle" class="ml-2 font-normal text-blue-300"></span>
                </h2>
                <button onclick="closeLyricsModal()" class="hover:bg-blue-800 p-2 rounded-full transition text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <textarea id="lyricsEditor" placeholder="Escribe o edita la letra aquí..." readonly class="w-full h-80 bg-gray-800 border border-blue-600 rounded-lg p-4 text-base md:text-lg text-white font-mono leading-relaxed resize-none focus:outline-none focus:border-blue-400"></textarea>
                </div>
        </div>
    </div>
    
    <div id="globalInfoModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="info-container bg-white text-gray-900 max-h-[95vh] overflow-y-auto w-full">
            <div class="header info-header text-white p-10 text-center">
                <button onclick="closeGlobalInfoModal()" class="back-link float-left bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-full transition-colors">← Volver al Ranking</button>
                <h1 class="text-3xl md:text-4xl font-bold pt-10">🎵 La IA Musical 📚</h1>
            </div>

            <div class="info-section p-8 text-gray-700 leading-relaxed text-lg border-b border-gray-200">
                <p class="mb-6">
                    La novedad en la que la IA quiere integrase en una sociedad nos plantea una serie de preguntas en muchos temas de literatura, cine, teatro, cuentos, etc. Esta web sólo busca entretener en un ámbito de inspiraciones y composiciones musicales. Lo clásico no se olvida y deja entrar al futuro.
                    Durante el siglo XX hasta nuestros tiempos diversos escritores se han quedado guardados, pero con el tiempo se han quedado olvidados o son de poco interés. La idea de esta web es potenciar el ánimo de las letras y vivificarlas en una forma de animar o sorprender. Comprobarás cómo las letras conocidas o que olvidaste son tomadas desde una perspectiva 
                    musical y entonan un registro novedoso. Esto ocurre también con el cine, obras de teatro y por supuesto la música. Todo tiene un entrelazado para enseñarnos nuevas realidades sin olvidar lo clásico.
                </p>
                <p class="mb-6">
                    Sistema de votaciones:
Tienes 10 temas para votar. Se irán añadiendo más por semana(Aprox). Por cada tema tu decides qué puntuación dar a las canciones. Tienes hasta 5 votos para elegir, que genera cada uno de 5 a 10 puntos. Haz bien la elección, ya que no se pueden modificar hasta el reinicio de los votos. Una vez por semana (Aprox) se hará el escrutinio de los votos para el ranking de canciones. Entonces se conocerán las posiciones y el Top 3. Finalmente quedarán posicionadas las canciones un nuevo ranking. Las 2 últimas canciones desaparecerán del ranking. Si quieres volver a escuchar una canción que habias escuchado antes y ya no está, tendrás que ir a "Archivos". Estas 2 últimas posiciones dejan espacio para nuevas entradas de canciones.
                </p>
                <p>
                    Para cualquier opinión o sugerencia puedes escribir un comentario sobre esta web. Gracias
                </p>
            </div>

            <div class="chat-section p-8">
                <h2 class="chat-title text-2xl font-semibold mb-6 text-center">💬 Deja tu comentario</h2>

                <div class="comment-form p-6 rounded-xl mb-8">
                    <form id="globalCommentForm">
                        <div class="form-group mb-4">
                            <label for="globalUserName" class="block mb-1 font-semibold text-gray-600">Nombre:</label>
                            <input type="text" id="globalUserName" required placeholder="Tu nombre" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400">
                        </div>
                        <div class="form-group mb-6">
                            <label for="globalUserComment" class="block mb-1 font-semibold text-gray-600">Comentario:</label>
                            <textarea id="globalUserComment" required placeholder="Escribe tu comentario aquí..." rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 resize-y"></textarea>
                        </div>
                        <button type="submit" class="btn-submit text-white font-bold px-8 py-3 rounded-full transition-all hover:shadow-xl">Publicar comentario</button>
                    </form>
                </div>

                <div id="globalCommentsList" class="comments-list flex flex-col gap-4">
                    </div>
            </div>
        </div>
    </div>


    <footer class="bg-gradient-to-r from-cyan-950 to-teal-950 py-6 mt-12 border-t border-cyan-700">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <p class="text-cyan-200 text-lg mb-2">
                Desarrollador: <span class="font-bold text-cyan-100">Felipe Paredinas</span>
            </p>
            <p class="text-cyan-200 text-md mb-4">
    Información de contacto: 
    <a href="mailto:laIAmusical1978@hotmail.com" class="font-bold text-yellow-400 hover:text-yellow-500 transition-colors">laIAmusical1978@hotmail.com</a>
</p>
            
            <div class="space-x-4 text-md">
                <a href="https://www.cervantesvirtual.com/portales/literatura/" target="_blank" class="text-teal-300 hover:text-teal-100 transition-colors underline">Biblioteca virtual Miguel de Cervantes</a>
                <span class="text-cyan-400">|</span>
                <a href="https://www.literautas.com/" target="_blank" class="text-teal-300 hover:text-teal-100 transition-colors underline">Literaturas</a>
            </div>
        </div>
    </footer>

    <script>
        // --- DATA DE CANCIONES (BASE) ---
        // Se han añadido URLs de ejemplo reales para YouTube y Drive
        var initialSongs = [
            {
                id: 1,
                title: "Que la fuerza te acompañe",
                author: "Star wars",
                year: 1977,
                image: "https://i.postimg.cc/sf5JtHZK/fuerza.png",
                totalVotes: 0,
                // ENLACE DE YOUTUBE (EJEMPLO - REEMPLAZAR con tus vídeos)
                youtubeUrl: "https://youtu.be/kzSlu-m4FwA?si=yTbQUyseshlbC5w9", 
                // ENLACE DE DRIVE
                driveUrl: "https://drive.google.com/file/d/1e0nD8qbZr2FlBRsE0ohAjbzq46PsLV9U/view?usp=drive_link", 
                description: "La saga de Star Wars con toda su nostalgia ahora convertida en música.",
                comments: [],
                lyrics: `La noche es fría, las estrellas lejos ya Un largo camino queda por cruzar El miedo acecha en cada sombra de metal Pero hay un eco en mi alma que no está mal. Recuerdos de un maestro, una voz ancestral Que me enseñó a creer en algo inmaterial.

[Pre-Coro]
Sé que el peligro es real, la batalla está cerca Mi sable láser arde y mi fe no se tuerce. En el fondo del pozo, donde el bien es un murmullo, Escucho un susurro que me da un impulso.

[Coro]
Que el poder te guíe, que el destino te ampare, Que la energía te sostenga donde vayas. En la oscuridad, cuando el corazón se desgarre, Que la Fuerza te acompañe siempre, siempre.

[Verso 2]
Hay un imperio que oprime, un dominio fatal, Pero en los ojos de un amigo hay un brillo leal. No importa si estás solo o en una escuadra entera, Hay algo más grande que espera, que libera. Un hilo invisible que une a la galaxia, Una esperanza que nunca se rinde, ni se cansa.

[Pre-Coro] Sé que el peligro es real, la batalla está cerca Mi sable láser arde y mi fe no se tuerce. En el fondo del pozo, donde el bien es un murmullo, Escucho un susurro que me da un impulso.

[Coro]
Que el poder te guíe, que el destino te ampare, Que la energía te sostenga donde vayas. En la oscuridad, cuando el corazón se desgarre, Que la Fuerza te acompañe siempre, siempre.

[Puente]
Cruza el hiperespacio, no mires hacia atrás. Hay un Jedi en ti que nunca morirá jamás. Respira y siente el cosmos fluyendo a tu alrededor, Eres la luz que combate al opresor.

(Coro) Que el poder te guíe, que el destino te ampare, Que la energía te sostenga donde vayas. En la oscuridad, cuando el corazón se desgarre, Que la Fuerza te acompañe siempre, siempre.

[Outro]
Sí, siempre, en cada lucha. Que la Fuerza te acompañe. Que la Fuerza te acompañe.`
            },
            {
                id: 2,
                title: "Yo soy tu padre",
                author: "Star Wars 3",
                year: 1980,
                image: "https://i.postimg.cc/BZ2Cd71V/yosoytupadre.png",
                totalVotes: 0,
                // ENLACE DE YOUTUBE (EJEMPLO - REEMPLAZAR)
                youtubeUrl: "https://youtu.be/BFoJ8pw1BXY?si=K9RTyob2iyWWLLYO",
                // ENLACE DE DRIVE
                driveUrl: "https://drive.google.com/file/d/1ZiRisHEPzsMWe1Z-1JuoDyF-YeYjMxmK/view?usp=drive_link", 
                description: "La pasión flamenca de Lorca convertida en una experiencia musical única e inolvidable. Poema: Romance de la luna, luna",
                comments: [],
                lyrics: `[Intro - Sintetizadores oscuros y un redoble de tambores dramático, con un sample distorsionado de una respiración mecánica]

[Verso 1 - Melodía melancólica y un poco de misterio] Bajo la capa, el metal y el casco Mi voz resuena, un eco del pasado Me enfrentaste en el puente, espada de luz Buscando una verdad, una falsa virtud. Me dijiste que lo maté, que no hay perdón Pero el destino siempre tuvo otra visión.

[Pre-Coro - La música se intensifica, sube la tensión] Sientes la duda en cada latido El lado oscuro siempre te ha seguido Lo que Obi-Wan no pudo confesar Una verdad que no podrás borrar...

[Coro - Explosión de energía, coro potente, la frase central] No, yo soy tu padre. [¡Impacto!] El secreto galáctico, la cicatriz Yo soy tu padre. Tu origen, tu sangre, tu raíz. Abraza el poder, olvida el pasado Juntos en la sombra, todo ha cambiado.

[Verso 2 - Un tono más de súplica o de ofrecimiento] Mírame, Luke, detrás de la armadura Hay un hombre roto, sin su armadura. El Emperador lo ha visto, tu potencial Únete a mí, es un camino real. Podemos dominar la galaxia, mano a mano De un Sith y un Jedi, un vínculo extraño.

[Pre-Coro - La música se intensifica de nuevo] Sientes la duda en cada latido El lado oscuro siempre te ha seguido Lo que Obi-Wan no pudo confesar Una verdad que no podrás borrar...

[Coro - Máximo poder] No, yo soy tu padre. [¡Impacto!] El secreto galáctico, la cicatriz Yo soy tu padre. Tu origen, tu sangre, tu raíz. Abraza el poder, olvida el pasado Juntos en la sombra, todo ha cambiado.

[Puente - La música se calma, un solo de sintetizador épico y dramático, con una voz sampleada susurrando "Search your feelings..." - "Busca en tus sentimientos..."] "Es imposible", gritas sin aliento Pero tu corazón siente este lamento. Soy Anakin, soy Vader, la dualidad Tu futuro y mi oscura realidad.

[Coro- Repetición final con aún más fuerza] No, yo soy tu padre. [¡El grito final!] El secreto galáctico, la cicatriz Yo soy tu padre. Tu origen, tu sangre, tu raíz. Ven conmigo, es el único camino Juntos en la galaxia, ¡ese es tu destino!

[Outro - Desvanecimiento del sintetizador y la respiración de Vader, terminando con un sonido de sable de luz que se apaga]`
            },
            {
                id: 3,
                title: "Canción del Pirata",
                author: "José de Espronceda",
                year: 1840,
                image: "https://i.postimg.cc/s2BMQn3H/Gemini-Generated-Image-ymm9afymm9afymm9.png",
                totalVotes: 0,
                // ENLACE DE YOUTUBE (EJEMPLO - REEMPLAZAR)
                youtubeUrl: "https://youtube.com/@laliteraturamusical?si=hHIjTjWCnq2Y3yyB",
                // ENLACE DE DRIVE
                driveUrl: "https://drive.google.com/file/d/1FESYoCEEVHec7pt8qHd9TBGVx0HGMoor/view?usp=drive_link", 
                description: "La libertad y aventura del romanticismo español en una composición musical épica.",
                comments: [],
                lyrics: `Con diez cañones por banda,
viento en popa a toda vela,
no corta el mar, sino vuela,
un velero bergantín:
Bajel pirata que llaman
por su bravura el Temido,
en todo mar conocido
del uno al otro confín.

La luna en el mar riela,
en la lona gime el viento,
y alza un fuerte movimiento
las olas de plata y azul;
y ve el capitán pirata,
cantando alegre en la popa,
Asia a un lado, al otro Europa,
y allá a su frente Estambul.`
            },
            {
                id: 4,
                title: "Campos de Castilla",
                author: "Antonio Machado",
                year: 1912,
                image: "https://i.postimg.cc/Gm8vyPJG/Gemini-Generated-Image-erfnvcerfnvcerfn.png",
                totalVotes: 0,
                // ENLACE DE YOUTUBE (EJEMPLO - REEMPLAZAR)
                youtubeUrl: "https://youtube.com/@laliteraturamusical?si=hHIjTjWCnq2Y3yyB",
                // ENLACE DE DRIVE
                driveUrl: "https://drive.google.com/file/d/17wJUWWeQXcOiGreNjGRvhu46dlrDUAVH/view?usp=drive_link", 
                description: "Los paisajes castellanos de Machado cobran vida en una melodía contemplativa y profunda.",
                comments: [],
                lyrics: `¿Quién me presta una escalera,
para subir al madero
para quitarle los clavos
a Jesús el Nazareno?
Saeta popular

¡Oh la saeta, el cantar
al Cristo de los gitanos,
siempre con sangre en las manos
siempre por desenclavar!
¡Cantar del pueblo andaluz
que todas las primaveras
anda pidiendo escaleras
para subir a la cruz!
¡Cantar de la tierra mía,
que echa flores
al Jesús de la agonía,
y es la fe de mis mayores!
¡Oh, no eres tú mi cantar!
¡No puedo cantar, ni quiero,
a ese Jesús del madero,
sino al que anduvo en el mar!`
            },
            {
                id: 5,
                title: "Altazor",
                author: "Vicente Huidobro",
                year: 1931,
                image: "https://i.postimg.cc/N0Zr5mrF/Barco-pirata.jpg",
                totalVotes: 0,
                // ENLACE DE YOUTUBE (EJEMPLO - REEMPLAZAR)
                youtubeUrl: "https://youtu.be/Nqo1WXHvjoI?si=TDlmUXkYpwq-Xcrq",
                // ENLACE DE DRIVE
                driveUrl: "https://drive.google.com/file/d/1AcgtWTs8pOFsdRBvKBHisPX_HkXw2ORK/view?usp=drive_link", 
                description: "La vanguardia poética transformada en una experiencia sonora experimental y revolucionaria.",
                comments: [],
                lyrics: `No hay tiempo que perder
Enfermera de sombras y distancias
Yo vuelvo a ti huyendo del reino incalculable
De ángeles prohibidos por el amanecer

Detrás de tu secreto te escondías
En sonrisa de párpados y de aire
Yo levanté la capa de tu risa
Y corté las sombras que tenían
Tus signos de distancia señalados

Tu sueño se dormirá en mis manos
Marcado de las2 líneas de mi destino inseparable
En el pecho de un mismo pájaro
Que se consume en el fuego de su canto
De su canto llorando al tiempo
Porque se escurre entre los dedos

Sabes que tu mirada adorna los veleros
De las noches mecidas en la pesca.`
            },
            {
                id: 6,
                title: "Trilce",
                author: "César Vallejo",
                year: 1922,
                image: "https://i.postimg.cc/wxW16y8K/Trilce.jpg",
                totalVotes: 0,
                // ENLACE DE YOUTUBE (EJEMPLO - REEMPLAZAR)
                youtubeUrl: "https://youtube.com/@laliteraturamusical?si=hHIjTjWCnq2Y3yyB",
                // ENLACE DE DRIVE
                driveUrl: "https://drive.google.com/file/d/1ArrRC6iAOXmFBsJUw5gMCRWfHLD_MIwx/view?usp=drive_link", 
                description: "La innovación lingüística de Vallejo encuentra su expresión en armonías sorprendentes.",
                comments: [],
                lyrics: `Quién hace tanta bulla y ni deja
Testar las islas que van quedando.

Un poco más de consideración
en cuanto será tarde, temprano,
y se aquilatará mejor
el guano, la simple calabrina tesórea
que brinda sin querer,
en el insular corazón,
salobre alcatraz, a cada hialóidea grupada.

Un poco más de consideración,
y el mantillo líquido, seis de la tarde
DE LOS MÁS SOBERBIOS BEMOLES.

Y la península párase
por la espalda, abozaleada, impertérrita
en la línea mortal del equilibrio.`
            },
            {
                id: 7,
                title: "La Voz a Ti Debida",
                author: "Pedro Salinas",
                year: 1933,
                image: "https://images.unsplash.com/photo-1458560871784-56d23406c091?w=400&h=400&fit-crop",
                totalVotes: 0,
                // ENLACE DE YOUTUBE (EJEMPLO - REEMPLAZAR)
                youtubeUrl: "https://youtube.com/@laliteraturamusical?si=hHIjTjWCnq2Y3yyB",
                // ENLACE DE DRIVE
                driveUrl: "https://drive.google.com/file/d/17dRJL2X7fq5rlRn6ho-KsSETGs5Qkeb2/view?usp=drive_link",
                description: "El amor puro de Salinas convertido en una balada contemporánea llena de sentimiento.",
                comments: [],
                lyrics: `Tú vives siempre en tus actos.
Con la punta de tus dedos
pulsas el mundo, le arrancas
auroras, triunfos, colores,
alegrías: es tu música.
La vida es lo que tú tocas.

De tus ojos, sólo de ellos,
sale la luz que te guía
los pasos. Andas
por lo que ves. Nada más.

Y si una duda te hace
señas a diez mil kilómetros,
lo dejas todo, te arrojas
sobre proas, sobre alas,
estás ya allí; con los besos,
con los dientes la desgarras:
ya no es duda.
Tú nunca puedes dudar.

Porque has vuelto los misterios
del revés. Y tus enigmas,
lo que nunca entenderás,
son esas cosas tan claras:
la arena donde te tiendes,
la marcha de tu reloj
y el tierno cuerpo rosado
que te encuentras en tu espejo
cada día al despertar,
y es el tuyo. Los prodigios
que están descifrados ya.

Y nunca te equivocaste,
más que una vez, una noche
que te encaprichó una sombra
-la única que te ha gustado-.
Una sombra parecía.
Y la quisiste abrazar.
Y era yo.`
            },
            {
                id: 8,
                title: "Residencia en la Tierra",
                author: "Pablo Neruda",
                year: 1935,
                image: "https://i.postimg.cc/CKM7fn1J/Gemini-Generated-Image-z5c8kz5c8kz5c8kz.png",
                totalVotes: 0,
                // ENLACE DE YOUTUBE (EJEMPLO - REEMPLAZAR)
                youtubeUrl: "https://youtube.com/@laliteraturamusical?si=hHIjTjWCnq2Y3yyB",
                // ENLACE DE DRIVE
                driveUrl: "https://drive.google.com/file/d/1NtevvMlrWrlanbsIpIEpZYpf2fHNdfNC/view?usp=drive_link", 
                description: "La angustia existencial nerudiana transmutada en composiciones oscuras y evocadoras.",
                comments: [],
                lyrics: `Barcarola,
SI solamente me tocaras el corazón,
si solamente pusieras tu boca en mi corazón,
tu fina boca, tus dientes,
si pusieras tu lengua como una flecha roja
allí donde mi corazón polvoriento golpea,
si soplaras en mi corazón, cerca del mar, llorando,
sonaría con un ruido oscuro, con sonido de ruedas de tren con sueño,
como aguas vacilantes,
como el otoño en hojas,
como sangre,
con un ruido de llamas húmedas quemando el cielo,
sonando como sueños o ramas o lluvias,
o bocinas de puerto triste,
si tú soplaras en mi corazón cerca del mar,
como un fantasma blanco,
al borde de la espuma,
en mitad del viento,
como un fantasma desencadenado, a la orilla del mar, llorando.`
            },
            {
                id: 9,
                title: "Poeta en Nueva York (Vuelta de paseo)",
                author: "Federico García Lorca",
                year: 1940,
                image: "https://images.unsplash.com/photo-1485579149621-3123dd979885?w=400&h=400&fit-crop",
                totalVotes: 0,
                // ENLACE DE YOUTUBE (EJEMPLO - REEMPLAZAR)
                youtubeUrl: "https://youtube.com/@laliteraturamusical?si=hHIjTjWCnq2Y3yyB",
                // ENLACE DE DRIVE
                driveUrl: "https://drive.google.com/file/d/1-9_6Om33P7uIMcHgNWYgws2zmHUeuqKB/view?usp=drive_link", 
                description: "El surrealismo urbano de Lorca en la gran manzana, ahora en ritmos modernos.",
                comments: [],
                lyrics: `Asesinado por el cielo,
entre las formas que van hacia la sierpe
y las formas que buscan el cristal,
dejaré caer mis cabellos.
   Con el árbol de muñones que no canta
y el niño con el blanco rostro de huevo.
   Con los animalitos de cabeza rota
y el agua harapienta de los pies secos.
   Con todo lo que tiene cansancio sordomudo
y mariposa ahogada en el tintero.
   Tropezando con mi rostro distinto de cada día.
¡Asesinado por el cielo!`
            },
            {
                id: 10,
                title: "Marinero en Tierra",
                author: "Rafael Alberti",
                year: 1925,
                image: "https://images.unsplash.com/photo-1509114397022-ed747cca3f65?w=400&h=400&fit-crop",
                totalVotes: 0,
                // ENLACE DE YOUTUBE (EJEMPLO - REEMPLAZAR)
                youtubeUrl: "https://youtube.com/@laliteraturamusical?si=hHIjTjWCnq2Y3yyB",
                // ENLACE DE DRIVE
                driveUrl: "https://drive.google.com/file/d/1RoOZ6YiILZbmaQWX2-_4FGE_fuKyW1xB/view?usp=drive_link", 
                description: "La nostalgia marinera de Alberti navega en melodías que evocan el Mediterráneo.",
                comments: [],
                lyrics: `Yo, marinero, en la ribera mía,		
posada sobre un cano y dulce río		
que da su brazo a un mar de Andalucía,		

sueño en ser almirante de navío,		
para partir el lomo de los mares		
al sol ardiente y a la luna fría.		

¡Oh los yelos del sur! ¡Oh las polares		
islas del norte! ¡Blanca primavera,		
desnuda y yerta sobre los glaciares,		

cuerpo de roca y alma de vidriera!		
¡Oh estío tropical, rojo, abrasado,		
bajo el plumero azul de la palmera!		

Mi sueño, por el mar condecorado,		
va sobre su bajel, firme, seguro,		
de una verde sirena enamorado,		

concha del agua allá en su seno oscuro.		
¡Arrójame a las ondas, marinero:		
-Sirenita del mar, yo te conjuro!		

Sal de tu gruta, que adorarte quiero,		
sal de tu gruta, virgen sembradora,		
a sembrarme en el pecho tu lucero.		

Ya está flotando el cuerpo de la aurora		
en la bandeja azul del océano		
y la cara del cielo se colora		

de carmín. Deja el vidrio de tu mano		
disuelto en el alba urna de mi frente,		
alga de nácar, cantadora en vano		

bajo el vergel añil de la corriente.		
¡Gélidos desposorios submarinos		
con el ángel barquero del relente		

y la luna del agua por padrinos!		
El mar, la tierra, el aire, mi sirena,		
surcaré atado a los cabellos finos		

y verdes de tu álgida melena.		
Mis gallardetes blancos enarbola,		
¡oh marinero!, ante la aurora llena		

¡y ruede por el mar tu caracola!`
            }
        ];

        var songs = []; // Se inicializa con los datos cargados/base
        var userVotes = 0;
        var votingFor = null;
        var selectedSongId = null;
        var lastUpdateDate = null; // Para la lógica semanal
        
        // --- LOCAL STORAGE FUNCTIONS ---
        function saveAppData() {
            localStorage.setItem('songs', JSON.stringify(songs));
            localStorage.setItem('userVotes', userVotes);
            localStorage.setItem('lastUpdateDate', lastUpdateDate ? lastUpdateDate.toISOString() : null);
        }

        function loadAppData() {
            const savedSongs = localStorage.getItem('songs');
            const savedVotes = localStorage.getItem('userVotes');
            const savedDate = localStorage.getItem('lastUpdateDate');

            songs = savedSongs ? JSON.parse(savedSongs) : initialSongs;
            // CORRECCIÓN PARA EVITAR 'NaN': Asegurar que userVotes es un número, por defecto 0.
            userVotes = savedVotes !== null && !isNaN(parseInt(savedVotes)) ? parseInt(savedVotes) : 0;
            
            lastUpdateDate = savedDate && savedDate !== 'null' ? new Date(savedDate) : new Date();

            // Asegurar que todas las canciones tengan una propiedad comments (para evitar errores)
            songs = songs.map(song => {
                if (!song.comments) song.comments = [];
                // Asegurar que tienen las URLs
                if (!song.youtubeUrl || song.youtubeUrl === "PEGAR_AQUI_ENLACE_YOUTUBE_FALTANTE") song.youtubeUrl = "https://www.youtube.com/watch?v=dQw4w9WgXcQ"; // Enlace de Fallback
                if (!song.driveUrl || song.driveUrl === "PEGAR_AQUI_ENLACE_DRIVE_FALTANTE") song.driveUrl = "https://drive.google.com/file/d/1FESYoCEEVHec7pt8qHd9TBGVx0HGMoor/view?usp=drive_link"; // Enlace de Fallback
                
                if (song.audioUrl) delete song.audioUrl; 
                return song;
            });
            
            // Actualizar el contador de votos inmediatamente
            document.getElementById('voteCount').textContent = userVotes;
        }
        
        function checkAndResetWeeklyData() {
            const oneWeek = 7 * 24 * 60 * 60 * 1000; // 7 días en milisegundos
            const now = new Date();
            const lastUpdate = lastUpdateDate || now;
            
            if (now.getTime() - lastUpdate.getTime() >= oneWeek) {
                
                const sortedSongs = songs.slice().sort((a, b) => b.totalVotes - a.totalVotes);
                
                const songsToKeep = sortedSongs.slice(0, sortedSongs.length - 2);
                const removedSongs = sortedSongs.slice(sortedSongs.length - 2);
                
                const newSongId1 = Math.max(...songs.map(s => s.id)) + 1;
                const newSongId2 = newSongId1 + 1;

                const newSongs = [
                    { 
                        id: newSongId1, 
                        title: "Nuevo Poema 1", 
                        author: "Nuevo Autor", 
                        year: 2024, 
                        image: "https://images.unsplash.com/photo-1506748686214-e9df14d4d13b?w=400&h=400&fit-crop", 
                        totalVotes: 0, 
                        youtubeUrl: "https://www.youtube.com/watch?v=F0h2z-R8K54", 
                        driveUrl: "https://drive.google.com/file/d/NEW1/view?usp=drive_link", 
                        description: "Nueva entrada misteriosa 1. ¡Vota ahora!", 
                        comments: [], 
                        lyrics: "Nueva letra 1." 
                    },
                    { 
                        id: newSongId2, 
                        title: "Nuevo Poema 2", 
                        author: "Nuevo Autor", 
                        year: 2024, 
                        image: "https://images.unsplash.com/photo-1510511459019-5be77d4c5770?w=400&h=400&fit-crop", 
                        totalVotes: 0, 
                        youtubeUrl: "https://www.youtube.com/watch?v=e_R3H1cO4jM", 
                        driveUrl: "https://drive.google.com/file/d/NEW2/view?usp=drive_link", 
                        description: "Nueva entrada misteriosa 2. ¡Vota ahora!", 
                        comments: [], 
                        lyrics: "Nueva letra 2." 
                    }
                ];
                
                songs = songsToKeep.concat(newSongs).map(song => ({ ...song, totalVotes: 0 })); 
                userVotes = 0; 
                lastUpdateDate = now; 

                alert(`¡Actualización Semanal Realizada!
                - Se han eliminado 2 canciones (Bottom 2) del ranking y pasado a "Audios".
                - Se han añadido 2 nuevas canciones.
                - Todos los votos han sido reiniciados.`);
            }
        }


        // --- GLOBAL COMMENTS DATA AND FUNCTIONS ---
        let globalComments = [];
        function loadGlobalComments() {
            globalComments = JSON.parse(localStorage.getItem('globalComments') || '[]');
            renderGlobalComments();
        }

        function saveGlobalComments() {
            localStorage.setItem('globalComments', JSON.stringify(globalComments));
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function renderGlobalComments() {
            const commentsList = document.getElementById('globalCommentsList');
            
            if (!commentsList) return; 

            if (globalComments.length === 0) {
                commentsList.innerHTML = '<div class="no-comments text-center text-gray-400 p-10 italic">No hay comentarios aún. ¡Sé el primero en comentar!</div>';
                return;
            }

            commentsList.innerHTML = globalComments.map(comment => `
                <div class="comment-item bg-gray-50 p-5 rounded-xl transition transform hover:translate-x-1 shadow-md">
                    <div class="comment-header flex justify-between items-start mb-2">
                        <span class="comment-author text-lg font-bold">${escapeHtml(comment.author)}</span>
                        <span class="comment-date text-sm text-gray-500">${comment.date}</span>
                    </div>
                    <div class="comment-text text-gray-700 leading-relaxed mb-3">${escapeHtml(comment.text)}</div>
                    <div class="comment-actions flex gap-2">
                        <button class="btn-edit text-white px-3 py-1 rounded transition-colors" onclick="editGlobalComment(${comment.id})">Editar</button>
                        <button class="btn-delete text-white px-3 py-1 rounded transition-colors" onclick="deleteGlobalComment(${comment.id})">Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('globalCommentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const userName = document.getElementById('globalUserName').value.trim();
            const userComment = document.getElementById('globalUserComment').value.trim();
            
            if (userName && userComment) {
                const newComment = {
                    id: Date.now(),
                    author: userName,
                    text: userComment,
                    date: new Date().toLocaleString('es-ES')
                };
                
                globalComments.unshift(newComment);
                saveGlobalComments();
                renderGlobalComments();
                
                // Limpiar formulario
                document.getElementById('globalUserName').value = '';
                document.getElementById('globalUserComment').value = '';
            }
        });

        function editGlobalComment(id) {
            const comment = globalComments.find(c => c.id === id);
            if (!comment) return;
            
            const newText = prompt('Editar comentario:', comment.text);
            
            if (newText !== null && newText.trim() !== '') {
                comment.text = newText.trim();
                saveGlobalComments();
                renderGlobalComments();
            }
        }

        function deleteGlobalComment(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este comentario?')) {
                globalComments = globalComments.filter(c => c.id !== id);
                saveGlobalComments();
                renderGlobalComments();
            }
        }

        function openGlobalInfoModal() {
            loadGlobalComments(); 
            document.getElementById('globalInfoModal').classList.remove('hidden');
        }

        function closeGlobalInfoModal() {
            document.getElementById('globalInfoModal').classList.add('hidden');
        }
        
        document.getElementById('globalInfoModal').addEventListener('click', function(e) {
            if (e.target.id === 'globalInfoModal') closeGlobalInfoModal();
        });

        // --- FUNCIONES DE ENLACE DE DEEPLINK ---

        /**
         * Intenta abrir un enlace de YouTube en la aplicación móvil
         * @param {string} youtubeUrl El enlace completo de YouTube (ej: https://www.youtube.com/watch?v=VIDEO_ID)
         */
        function openYoutubeApp(youtubeUrl) {
            // 1. Extraer el ID del video
            var videoIdMatch = youtubeUrl.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})/);
            var videoId = videoIdMatch ? videoIdMatch[1] : null;

            if (!videoId) {
                window.open(youtubeUrl, '_blank');
                return;
            }

            var appUrl = 'vnd.youtube://' + videoId;
            var webUrl = 'https://www.youtube.com/watch?v=' + videoId;

            // 2. Intentar usar Intent para Android (la forma más fiable)
            if (navigator.userAgent.match(/Android/i)) {
                var intentUrl = 'intent://' + 
                    'www.youtube.com/watch?v=' + videoId + '#Intent;' +
                    'scheme=https;' +
                    'package=com.google.android.youtube;' +
                    'S.browser_fallback_url=' + encodeURIComponent(webUrl) + ';' +
                    'end';
                    
                window.location.href = intentUrl;
            } 
            // 3. Intentar usar el deeplink para iOS y otros, con fallback
            else {
                window.location.href = appUrl;
                
                // Fallback a web si la app no abre después de un tiempo
                setTimeout(function() {
                     if (document.visibilityState === 'visible' || !document.hidden) {
                         window.open(webUrl, '_blank');
                     }
                }, 500);
            }
        }
        
        /**
         * Intenta abrir un enlace de Google Drive en la aplicación móvil
         * @param {string} driveUrl El enlace completo de Google Drive
         */
        function openDriveApp(driveUrl) {
            var regex = /file\/d\/([a-zA-Z0-9_-]+)/;
            var match = driveUrl.match(regex);
            var fileId = match ? match[1] : null;

            if (!fileId) {
                window.open(driveUrl, '_blank');
                return;
            }

            var standardUrl = 'https://drive.google.com/file/d/' + fileId + '/view?usp=sharing'; 

            if (navigator.userAgent.match(/Android/i)) {
                var intentUrl = 'intent://' + 
                    'docs.google.com/file/d/' + fileId + '/view#Intent;' +
                    'scheme=https;' +
                    'package=com.google.android.apps.docs;' +
                    'end';
                    
                window.location.href = intentUrl;
            } 
            else {
                var deepLinkUrl = 'googledrive://' + fileId; 
                window.location.href = deepLinkUrl;

                setTimeout(function() {
                    if (document.visibilityState === 'visible' || !document.hidden) {
                         window.open(standardUrl, '_blank');
                    }
                }, 500);
            }
        }


        // --- FUNCIONES DEL RANKING (MODIFICADAS) ---
        function renderSongs() {
            var sortedSongs = songs.slice().sort(function(a, b) {
                return b.totalVotes - a.totalVotes;
            });
            
            var top3 = sortedSongs.slice(0, 3);
            var top3Container = document.getElementById('top3Container');
            var top3Html = '';
            
            // Iconos SVG para los botones de escucha
            const audioSvg = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>';
            const youtubeSvg = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.613-.264-7.525-.373-11.614 0C2.924 3.42 2.05 4.364 2 5.485v13.03c.05.992.934 1.936 5.001 2.217 4.088.264 7.999.373 11.614 0 4.075-.28 4.962-1.224 5.001-2.217V5.485c-.039-1.121-.925-2.065-5.001-2.217zM10 16.5v-9l6 4.5-6 4.5z"/></svg>'; 


            for (var i = 0; i < top3.length; i++) {
                var song = top3[i];
                var votingButtons = '';
                
                if (votingFor === song.id) {
                    votingButtons = '<div class="grid grid-cols-3 gap-2 bg-cyan-950/50 p-3 rounded-lg border border-cyan-500">';
                    var points = [5, 6, 7, 8, 9, 10];
                    for (var j = 0; j < points.length; j++) {
                        votingButtons += '<button onclick="vote(' + song.id + ', ' + points[j] + ')" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 py-2 rounded-lg font-bold transition-all hover:scale-110 flex items-center justify-center gap-1"><svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>' + points[j] + '</button>';
                    }
                    votingButtons += '</div>';
                }
                
                // Botón de YouTube ELIMINADO de la vista principal.
                top3Html += '<div class="relative group"><div class="absolute -inset-1 bg-gradient-to-r from-yellow-400 via-orange-400 to-red-400 rounded-2xl blur opacity-75 group-hover:opacity-100 transition duration-300"></div><div class="relative bg-gradient-to-br from-cyan-900 to-teal-900 rounded-2xl p-6 border-2 border-yellow-400"><div class="absolute -top-4 -left-4 bg-yellow-400 text-gray-900 w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold shadow-lg">' + (i + 1) + '</div><img src="' + song.image + '" alt="' + song.title + '" onclick="showInfo(' + song.id + ')" class="w-full h-48 object-cover rounded-lg mb-4 cursor-pointer hover:scale-105 transition-transform" /><h3 class="text-xl font-bold mb-2">' + song.title + '</h3><p class="text-cyan-200 mb-2">' + song.author + ' (' + song.year + ')</p><div class="flex items-center justify-between mb-4"><span class="text-2xl font-bold text-yellow-300">' + song.totalVotes + ' pts</span></div><div class="space-y-2"><button onclick="toggleVoting(' + song.id + ')" ' + (userVotes >= 5 ? 'disabled' : '') + ' class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 disabled:from-gray-600 disabled:to-gray-700 py-3 rounded-lg font-bold transition-all hover:scale-105 disabled:scale-100 disabled:cursor-not-allowed flex items-center justify-center gap-2"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>VOTAR</button>' + votingButtons + 
                // Botón de Drive Modificado (solo icono de audio) - Mantenido como único enlace de media aquí
                '<button onclick="openDriveApp(\'' + song.driveUrl + '\')" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 py-3 rounded-lg font-bold transition-all hover:scale-105 flex items-center justify-center gap-2">' + audioSvg + '</button>' +
                '</div></div></div></div>';
            }
            top3Container.innerHTML = top3Html;

            var ranking = sortedSongs.slice(3);
            var rankingContainer = document.getElementById('rankingContainer');
            var rankingHtml = '';
            
            for (var i = 0; i < ranking.length; i++) {
                var song = ranking[i];
                var votingButtons = '';
                
                if (votingFor === song.id) {
                    votingButtons = '<div class="grid grid-cols-3 gap-1 bg-cyan-950/50 p-2 rounded-lg border border-cyan-500">';
                    var points = [5, 6, 7, 8, 9, 10];
                    for (var j = 0; j < points.length; j++) {
                        votingButtons += '<button onclick="vote(' + song.id + ', ' + points[j] + ')" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 py-1 px-1 rounded text-sm font-bold transition-all hover:scale-110 flex items-center justify-center gap-1"><svg class="w-3 h-3 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>' + points[j] + '</button>';
                    }
                    votingButtons += '</div>';
                }
                
                rankingHtml += '<div class="bg-cyan-800/40 backdrop-blur-sm rounded-xl p-4 border border-cyan-600/50 hover:border-cyan-400 transition-all hover:scale-105"><div class="flex items-start gap-4"><div class="flex-shrink-0"><div class="bg-teal-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">' + (i + 4) + '</div></div><img src="' + song.image + '" alt="' + song.title + '" onclick="showInfo(' + song.id + ')" class="w-24 h-24 object-cover rounded-lg cursor-pointer hover:scale-110 transition-transform" /><div class="flex-grow"><h3 class="text-lg font-bold mb-1">' + song.title + '</h3><p class="text-cyan-200 text-sm mb-2">' + song.author + ' (' + song.year + ')</p><p class="text-xl font-bold text-yellow-300 mb-2">' + song.totalVotes + ' pts</p><div class="space-y-2"><button onclick="toggleVoting(' + song.id + ')" ' + (userVotes >= 5 ? 'disabled' : '') + ' class="w-full bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-600 py-2 rounded-lg text-sm font-bold transition-all disabled:cursor-not-allowed flex items-center justify-center gap-1"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>VOTAR</button>' + votingButtons + 
                // Botón de YouTube ELIMINADO, solo queda el de Drive/Audio.
                '<button onclick="openDriveApp(\'' + song.driveUrl + '\')" class="w-full bg-purple-600 hover:bg-purple-700 py-2 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-1">' + audioSvg + ' Audio</button>' + 
                '</div></div></div></div>';
            }
            rankingContainer.innerHTML = rankingHtml;
        }

        function toggleVoting(songId) {
            if (userVotes >= 5) {
                showVoteWarning();
                return;
            }
            votingFor = votingFor === songId ? null : songId;
            renderSongs();
        }

        function vote(songId, points) {
            if (userVotes >= 5) {
                 showVoteWarning();
                 return;
            }

            for (var i = 0; i < songs.length; i++) {
                if (songs[i].id === songId) {
                    songs[i].totalVotes += points;
                    break;
                }
            }
            userVotes++;
            votingFor = null;
            
            saveAppData(); 
            
            document.getElementById('voteCount').textContent = userVotes;
            renderSongs();
        }

        function showVoteWarning() {
            var warning = document.getElementById('voteWarning');
            warning.classList.remove('hidden');
            setTimeout(function() {
                warning.classList.add('hidden');
            }, 3000);
        }

        function showInfo(songId) {
            selectedSongId = songId;
            var song = songs.find(s => s.id === songId);
            if (!song) return;

            var infoContent = document.getElementById('infoContent');
            var commentsHtml = song.comments.map(comment => {
                return '<div class="bg-cyan-800/30 rounded-lg p-4 border border-cyan-700"><div class="flex justify-between items-start"><div class="flex-grow"><p class="text-white mb-2">' + comment.text + '</p><p class="text-xs text-cyan-400">' + comment.date + '</p></div><button onclick="deleteComment(' + comment.id + ')" class="ml-2 text-red-400 hover:text-red-300 transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div>';
            }).join('');
            
            // Iconos SVG para el modal de información (se mantienen)
            const youtubeSvg = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.613-.264-7.525-.373-11.614 0C2.924 3.42 2.05 4.364 2 5.485v13.03c.05.992.934 1.936 5.001 2.217 4.088.264 7.999.373 11.614 0 4.075-.28 4.962-1.224 5.001-2.217V5.485c-.039-1.121-.925-2.065-5.001-2.217zM10 16.5v-9l6 4.5-6 4.5z"/></svg>'; 
            const driveSvg = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm-2.5 15.5l-5-5c-.375-.375-.375-.98 0-1.354l5-5c.375-.375.98-.375 1.354 0l5 5c.375.375.375.98 0 1.354l-5 5c-.375.375-.98.375-1.354 0zM12 8.646L13.707 10.354l-1.707 1.707L10.293 10.354l1.707-1.707z"/></path></svg>'; 

            var infoContentHtml = '<img src="' + song.image + '" alt="' + song.title + '" class="w-full h-64 object-cover rounded-lg mb-6" /><h3 class="text-3xl font-bold mb-3">' + song.title + '</h3><p class="text-xl text-cyan-200 mb-2">Autor: ' + song.author + '</p><p class="text-lg text-cyan-300 mb-4">Año: ' + song.year + '</p><p class="text-lg mb-6 leading-relaxed">' + song.description + '</p><div class="flex flex-col md:flex-row gap-4 mb-6"><button onclick="openLyricsModal(' + song.id + ')" class="flex-1 bg-yellow-600 hover:bg-yellow-700 px-6 py-3 rounded-lg font-bold transition-all hover:scale-105 flex items-center justify-center gap-2"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>Letra</button>' + 
            // Botones MANTENIDOS en el modal de información detallada
            '<button onclick="openYoutubeApp(\'' + song.youtubeUrl + '\')" class="flex-1 bg-red-600 hover:bg-red-700 px-6 py-3 rounded-lg font-bold transition-all hover:scale-105 flex items-center justify-center gap-2">' + youtubeSvg + ' Abrir en YouTube</button>' +
            '<button onclick="openDriveApp(\'' + song.driveUrl + '\')" class="flex-1 bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-bold transition-all hover:scale-105 flex items-center justify-center gap-2">' + driveSvg + ' Abrir en Drive</button></div>' +
            '<div class="border-t border-cyan-600 pt-6"><h4 class="text-xl font-bold mb-4 flex items-center"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>Comentarios (' + song.comments.length + ')</h4><div class="mb-4"><textarea id="commentInput" placeholder="Escribe tu comentario..." class="w-full bg-cyan-800/50 border border-cyan-600 rounded-lg p-3 text-white placeholder-cyan-400 focus:outline-none focus:border-cyan-400" rows="3"></textarea><button onclick="addComment()" class="mt-2 bg-emerald-600 hover:bg-emerald-700 px-4 py-2 rounded-lg font-bold transition">Añadir Comentario</button></div><div id="commentsContainer" class="space-y-3">' + commentsHtml + '</div></div>';
            
            infoContent.innerHTML = infoContentHtml;
            
            document.getElementById('infoModal').classList.remove('hidden');
        }

        function closeInfoModal() {
            document.getElementById('infoModal').classList.add('hidden');
            selectedSongId = null;
        }

        function addComment() {
            var commentText = document.getElementById('commentInput').value.trim();
            if (!commentText) return;
            
            for (var i = 0; i < songs.length; i++) {
                if (songs[i].id === selectedSongId) {
                    songs[i].comments.push({
                        id: Date.now(),
                        text: commentText,
                        date: new Date().toLocaleDateString('es-ES')
                    });
                    break;
                }
            }
            
            // Guardar el nuevo estado de canciones (con el nuevo comentario)
            saveAppData(); 

            showInfo(selectedSongId);
        }

        function deleteComment(commentId) {
            for (var i = 0; i < songs.length; i++) {
                if (songs[i].id === selectedSongId) {
                    songs[i].comments = songs[i].comments.filter(function(c) {
                        return c.id !== commentId;
                    });
                    break;
                }
            }
            
            // Guardar el nuevo estado de canciones
            saveAppData(); 
            
            showInfo(selectedSongId);
        }
        
        // --- FUNCIONES DEL MODAL DE LETRAS MEJORADO ---
        function openLyricsModal(songId) {
            selectedSongId = songId;
            var song = songs.find(s => s.id === songId);
            if (!song) return;

            document.getElementById('currentSongTitle').textContent = song.title;
            
            // MODIFICACIÓN 5: La letra mostrada SIEMPRE es la original del objeto song.
            // Se ignora el localStorage y no se ofrece la opción de guardar/editar.
            const displayLyrics = song.lyrics;

            // Al ser 'readonly' en el HTML, solo mostramos el contenido.
            document.getElementById('lyricsEditor').value = displayLyrics;
            
            closeInfoModal(); 
            document.getElementById('lyricsModal').classList.remove('hidden'); 
            
            // Se re-añade la propiedad 'readonly' en JS para asegurar que no se puede escribir
            document.getElementById('lyricsEditor').setAttribute('readonly', 'true');
        }

        function closeLyricsModal() {
            document.getElementById('lyricsModal').classList.add('hidden');
            selectedSongId = null;
        }

        // ELIMINADO: function saveLyrics() para evitar la edición local

        // --- INICIALIZACIÓN ---
        function init() {
            loadAppData(); // Cargar estado guardado
            checkAndResetWeeklyData(); // Verificar si debe ocurrir la actualización semanal
            saveAppData(); // Guardar el estado después de la posible actualización
            renderSongs();
            loadGlobalComments();
        }
        
        // Cierre de modales al clickear fuera (Mantenido y adaptado)
        document.getElementById('audioModal').addEventListener('click', function(e) {
            if (e.target === this) { /* closeAudioModal(); */ } 
        });

        document.getElementById('infoModal').addEventListener('click', function(e) {
            if (e.target === this) closeInfoModal();
        });

        document.getElementById('lyricsModal').addEventListener('click', function(e) {
            if (e.target === this) closeLyricsModal(); 
        });

        // Ejecutar la inicialización al cargar la página
        window.onload = init;
    </script>
</body>
</html>